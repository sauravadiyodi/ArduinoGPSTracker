
/**
 * The code below uses open source software. Please visit the URL below for an overview of the licenses:
 * http://js.api.here.com/v3/3.1.6.0/HERE_NOTICE
 */

H.util.eval("Uf.prototype.Oc=ca(1,function(a,b){this.a.Oc(a,Tb(b)?b:this.c)});Zf.prototype.Oc=ca(0,function(a,b){var c=0,d;if(!a(this)&&b--)for(;3>=c;c++)(d=this[c])&&d.Oc(a,b)});function ts(a,b,c){this.f=this.c=c;this.ai=[];this.a=0;this.O=Qf(a,b,!0)}u(\"H.clustering.grid.Cluster\",ts);ts.prototype.oe=function(a){this.b||(this.b=Lf(a));this.a+=a.wt||1;this.ai.push(a)};ts.prototype.ya=function(){return this.b};ts.prototype.getPosition=ts.prototype.ya;ts.prototype.Ac=function(){return this.a};ts.prototype.getWeight=ts.prototype.Ac;ts.prototype.od=Qe;ts.prototype.isCluster=ts.prototype.od;ts.prototype.wc=function(){return this.c};ts.prototype.getMinZoom=ts.prototype.wc;\nts.prototype.Gf=function(){return this.f};ts.prototype.getMaxZoom=ts.prototype.Gf;ts.prototype.I=function(){return this.O};ts.prototype.getBoundingBox=ts.prototype.I;ts.prototype.Yg=function(a){this.ze(a)};ts.prototype.forEachEntry=ts.prototype.Yg;ts.prototype.ze=function(a){var b=this;if(!r(a))throw new D(this.ze,0,a);this.ai.forEach(function(c){a(new us(c,b.c+1))})};ts.prototype.forEachDataPoint=ts.prototype.ze;function vs(a){Ac.call(this);this.a=[];var b;a?Pa(b={},ws,a):b=ws;this.g=b;Ac.call(this)}w(vs,Ac);var xs={clusters:[],noisePoints:[]},ws={projection:Hh,min:0,max:22,eps:32,minWeight:2};n=vs.prototype;n.Kc=function(a){this.a=a;this.b=!0};n.Kb=function(a){this.a.push(a);this.b=!0};n.nf=function(a){this.a=this.a.concat(a);this.b=!0};n.We=function(a){this.a=this.a.filter(function(b){return b!==a});this.b=!0};n.u=function(){vs.l.u.call(this);this.a=null};n.Hk=vc;function us(a,b){this.a=a;this.b=b}u(\"H.clustering.grid.NoisePoint\",us);us.prototype.ya=function(){return Lf(this.a)};us.prototype.getPosition=us.prototype.ya;us.prototype.Ac=function(){return this.a.wt};us.prototype.getWeight=us.prototype.Ac;us.prototype.od=Re;us.prototype.isCluster=us.prototype.od;us.prototype.wc=function(){return this.b};us.prototype.getMinZoom=us.prototype.wc;us.prototype.getData=function(){return this.a.data};us.prototype.getData=us.prototype.getData;function ys(a){vs.call(this,a)}w(ys,vs);\nys.prototype.yi=function(a){var b=this.g,c=b.min,d=b.max,e=[],f=[],g;if(this.b){for(g=this.a;c<=d;c++){for(var h,k=void 0,l,m,p,q,t,v,x,E=c,O=g,Y=e,Fa=f,oa=b.eps,Na=b.projection,ia=b.minWeight,Vb=O.length,ob=Math.pow(2,E+8),Vc=[];x=O[--Vb];)if(!x.Hi){m=Na.Ob(x).scale(ob).floor();v=ob;t=m.x;q=m.y;for(l=Vc.length;l--;)h=Vc[l],p=h.ya(),h.Gi||(h.Gi=Na.Ob(p).scale(ob).floor()),p=h.Gi,p=p.bb(m),p<v&&(v=p,k=h);k&&k.I().Gd(x)||(k=new ts(Na.Yf({x:(t-oa)/ob,y:(q-oa)/ob}),Na.Yf({x:(t+oa)/ob,y:(q+oa)/ob}),E),\nVc.push(k));k.oe(x);k=null}for(Vb=Vc.length;Vb--;)if(h=Vc[Vb],l=h.Ac(),l<ia)for(h=h.ai,l=h.length;x=h[--l];)Fa.push(new us(x,E)),x.Hi=!0;else Y.push(h)}c=0;for(d=g.length;c<d;c++)delete g[c].Hi;this.b=!1;a({clusters:e,noisePoints:f})}};function zs(a){this.a=a;a=document.createElement(\"canvas\");var b=a.getContext(\"2d\"),c=a.width=a.height=14*this.a;b.beginPath();b.strokeStyle=\"#FFFFFF\";b.fillStyle=\"#1080DD\";b.arc(c/2,c/2,6*this.a,0,2*Math.PI,!1);b.fill();b.lineWidth=1;b.stroke();this.f=new Si(a,{size:{w:c,h:c},anchor:{x:c/2,y:c/2}});this.b={};this.c={}}u(\"H.clustering.theme.Circular\",zs);\nfunction As(a,b,c){var d,e=document.createElement(\"canvas\"),f=e.getContext(\"2d\");b*=a.a;var g=b+\":\"+c;e.width=e.height=b;(d=a.b[g])?f.putImageData(d,0,0):(d=b/2,f.beginPath(),f.strokeStyle=\"rgba(\"+c+\",0.2)\",f.fillStyle=\"rgba(\"+c+\",1)\",f.arc(d,d,d/5*3,0,2*Math.PI,!1),f.fill(),f.lineWidth=d/5*4,f.stroke(),a.b[g]=f.getImageData(0,0,b,b));return e}\nzs.prototype.Zl=function(a){var b=a.Ac();var c=this.c[b];if(!c){if(10>b){c=As(this,28,\"118,209,0\");var d={x:11,y:18}}else 25>b?(c=As(this,38,\"255,105,0\"),d={x:13,y:23}):50>b?(c=As(this,38,\"240,60,0\"),d={x:13,y:23}):100>b?(c=As(this,38,\"181,0,21\"),d={x:13,y:23}):1E3>b?(c=As(this,48,\"181,0,21\"),d={x:15,y:28}):(c=As(this,66,\"181,0,21\"),d={x:20,y:38});var e=d;d=c.width;var f=c.getContext(\"2d\");f.fillStyle=\"#FFFFFF\";var g=11*this.a;f.font=\"bold \"+g+\"px Arial\";g=e.x*this.a;e=e.y*this.a;f.fillText(b,g,e);\nc=new Si(c,{anchor:{x:d/2,y:d/2}});this.c[b]=c}b=new Om(a.ya(),{icon:c,min:a.wc(),max:a.Gf()});b.setData(a);return b};zs.prototype.getClusterPresentation=zs.prototype.Zl;zs.prototype.Bm=function(a){var b=new Om(a.ya(),{icon:this.f,min:a.wc()});b.setData(a);return b};zs.prototype.getNoisePresentation=zs.prototype.Bm;function Bs(a){vs.call(this,a);a=this.g;if(a.projection!==Hh)throw new D(Bs,0,\"Other projection than mercator not supported yet\");this.m=a.projection;this.f=a.eps;this.v=a.minWeight;this.s=new Ih(this.m);(new xf).a(\"cluster\",\"H.clustering.dynamicgrid.worker\");this.i=A(this.i,this);this.j=A(this.j,this)}w(Bs,vs);Bs.prototype.Hk=function(a,b){this.W=a;this.o=Lc(b)};\nBs.prototype.yi=function(a,b){var c=this.c;var d=this.W,e=this.o||0;var f=!c||!(c.zoom===e&&c.b.ca(d));if(d&&(this.b||f)){c&&3>c.ae&&c.cancel();this.b=!1;c=this.f;if(c>=128*Qc(2,e))var g=Cs;else{f=this.s;f.Da(e);var h=f.jb(d.Sb());g=f.jb(d.Pb());h.y-=c;g.y+=c;h=f.Te(h);var k=f.Te(g);g=new J(h.lat,h.lng,k.lat,k.lng);c=f.Sa(c,0).lng+180;g=g.Ec(h.lat,h.lng-c,k.lat,h.lng).Ec(h.lat,k.lng,k.lat,k.lng+c)}c=g;h=this.a;g=[];for(f=h.length;f--;)c.Gd(h[f])&&g.push(h[f]);0<g.length?(this.c=new Ds(d,e,g,this.f,\nthis.v,this.m!==Hh,a,b),this.c.then(this.i,this.j)):a(xs)}};Bs.prototype.i=function(a){va(a)||(a=new y.Uint32Array(a));this.c.i(Es(this,a))};Bs.prototype.j=function(a){ra(a)&&this.c.g(a)};var Cs=new J(90,-180,-90,180);\nfunction Es(a,b){for(var c=0,d=b[c++],e=Array(d),f=0,g=[],h=b.length,k=a.c.a,l=a.c.zoom;d--;)e[f++]=new us(k[b[c++]],l);for(;c<h;){d=b[c++];f=k[b[c]];var m=a.s;var p=a.f;m.Da(a.c.zoom);var q=m.jb(f);f=m.Sa(q.x-p,q.y-p);m=m.Sa(q.x+p,q.y+p);f=new J(f.lat,f.lng,m.lat,m.lng);for(f=new ts(f.Sb(),f.Pb(),l);d--;)f.oe(k[b[c++]]);g.push(f)}return{clusters:g,noisePoints:e}}Bs.prototype.u=function(){Bs.l.u.call(this)};\nfunction Ds(a,b,c,d,e,f,g,h){this.b=a;this.zoom=b;this.a=c;this.i=g;this.g=h;a=c.length;g=3*a;h=new (y.Float64Array||Array)(g);for(var k;a--;)k=c[a],h[--g]=k.lat,h[--g]=k.lng,h[--g]=k.wt;qd.call(this,\"cluster\",{message:[h,d,e,b,f]},void 0)}w(Ds,Af);function Fs(a,b,c){this.c=a;this.a=b;this.f=c}u(\"H.clustering.fastgrid.NoisePoint\",Fs);Fs.prototype.ya=function(){this.b||(this.b=this.c.Sa(this.a[1],this.a[0],1));return this.b};Fs.prototype.getPosition=Fs.prototype.ya;Fs.prototype.Ac=function(){return this.a.a};Fs.prototype.getWeight=Fs.prototype.Ac;Fs.prototype.od=Re;Fs.prototype.isCluster=Fs.prototype.od;Fs.prototype.wc=function(){return this.f-this.c.c};Fs.prototype.getMinZoom=Fs.prototype.wc;Fs.prototype.getData=function(){return this.a.data};\nFs.prototype.getData=Fs.prototype.getData;function Gs(a,b,c,d){this.c=a;this.a=b;this.j=c;this.s=d;this.g=Ba(this.g,this);this.f=Ba(this.f,this)}u(\"H.clustering.fastgrid.Cluster\",Gs);Gs.prototype.ya=function(){this.b||(this.b=this.c.Sa(this.a.re,this.a.se,this.a.Nb));return this.b};Gs.prototype.getPosition=Gs.prototype.ya;Gs.prototype.Ac=function(){return this.a.Nb};Gs.prototype.getWeight=Gs.prototype.Ac;Gs.prototype.od=Qe;Gs.prototype.isCluster=Gs.prototype.od;Gs.prototype.wc=function(){return this.j?this.j-this.c.c:-1/0};\nGs.prototype.getMinZoom=Gs.prototype.wc;Gs.prototype.Gf=function(){return this.s-this.c.c};Gs.prototype.getMaxZoom=Gs.prototype.Gf;Gs.prototype.I=function(){this.O||(this.O=Qf(this.c.Sa(this.a.a,this.a.f,1),this.c.Sa(this.a.b,this.a.c,1),!0));return this.O};Gs.prototype.getBoundingBox=Gs.prototype.I;Gs.prototype.Yg=function(a){this.i=a;this.a.Oc(this.g,gd)};Gs.prototype.forEachEntry=Gs.prototype.Yg;\nGs.prototype.g=function(a,b){var c=!1,d,e;a.Nb>=this.c.m&&a!==this.a&&a.Nb!==this.a.Nb&&(this.i(new Gs(this.c,a,0,b)),c=!0);if(!c&&(d=a.entries))for(a=d.length,e=0;e<a;e++)this.i(new Fs(this.c,d[e],b));return c};Gs.prototype.ze=function(a){this.m=a;this.a.Oc(this.f,gd)};Gs.prototype.forEachDataPoint=Gs.prototype.ze;Gs.prototype.f=function(a,b){var c;if(a=a.entries){var d=a.length;for(c=0;c<d;c++)this.m(new Fs(this.c,a[c],b))}return!1};function Hs(a,b,c,d,e,f){this.g=b;a&&(this.parent=a,b&1?(c=a[8],e=a[5]):(c=a[7],e=a[8]),b&2?(d=a[9],f=a[6]):(d=a[4],f=a[9]));this[7]=c;this[5]=e;this[8]=(c+e)/2;this[4]=d;this[6]=f;this[9]=(d+f)/2}n=Hs.prototype;n.$d=0;function Is(a,b){return a[b]||(++a.$d,a[b]=new Hs(a,b))}n.removeChild=function(a){var b=a.g;this[b]===a&&(delete this[b],delete a.parent,--this.$d)};n.Oc=function(a,b){for(var c=0,d=this;d=d.parent;)++c;Js(this,a,b,c)};\nfunction Js(a,b,c,d){var e,f;if(!b(a,d)&&c--)for(++d,e=0;4>e;e++)(f=a[e])&&Js(f,b,c,d)}n.re=0;n.se=0;n.Nb=0;function Ks(a){this.b=a||10;this.a=null;Ls(this)}function Ls(a){a.head=a.a=new Hs(null,NaN,0,0,4294967296,4294967296)}function Ms(a,b){var c,d;for(c=0;4>c;c++)if(d=b[c])Ms(a,d),delete b[c];delete b.parent;delete b.entries}function Ns(a,b){var c=a.head,d;if(b){var e=b;if(e!==c)for(c=e;e=e.parent;)if(e.entries||1<e.$d)c=e}else for(;!c.entries&&2>(d=c.$d);)if(d)c=e;else break;a.head=c}\nKs.prototype.Bc=function(a,b,c,d){var e=this.a;if(!(a>=e[7]&&b>=e[4]&&a<=e[5]&&b<=e[6]))throw Error(\"Coordinates out of bounds\");return Os(this,this.a,a,b,c,this.b,d)};\nfunction Os(a,b,c,d,e,f,g){var h=b.entries;if(f)if(b.$d)h=Os(a,Is(b,c>=b[8]|(d>=b[9])<<1),c,d,e,f-1,g);else if(h){h=h[0];var k=Is(b,h[1]>=b[8]|(h[0]>=b[9])<<1);k.entries=b.entries;k.re=b.re;k.se=b.se;k.Nb=b.Nb;k.a=b.a;k.f=b.f;k.b=b.b;k.c=b.c;delete b.entries;h.node=k;Ns(a,k);h=Os(a,Is(b,c>=b[8]|(d>=b[9])<<1),c,d,e,f-1,g)}else f=h=new Ps(c,d,e,g),(b.entries||(b.entries=[])).push(f),Ns(a,b);else h||Ns(a,b),a=h=new Ps(c,d,e,g),(b.entries||(b.entries=[])).push(a);b.re+=c*e;b.se+=d*e;b.Nb+=e;b.a===B?(b.a=\nb.b=c,b.f=b.c=d):(c<b.a?b.a=c:c>b.b&&(b.b=c),d<b.f?b.f=d:d>b.c&&(b.c=d));return h}Ks.prototype.Oc=function(a,b){Js(this.a,a,b===+b?b:this.b,0)};function Ps(a,b,c,d){this[0]=b;this[1]=a;this.a=c;this.data=d};function Qs(a){vs.call(this,a);a=this.g;this.j=a.projection;this.s=a.min;this.f=a.max;this.m=a.minWeight;this.c=7-Kc(Oc(Jc(1,a.eps))/Zc);this.i=new Ks(Jc(this.s,this.f+this.c))}w(Qs,vs);n=Qs.prototype;n.Kc=function(a){var b=0,c=a.length,d,e=new H(0,0),f=this.j,g=this.i;Qs.l.Kc.call(this,a);Ms(g,g.a);for(Ls(g);b<c;b++)f.Ob(d=a[b],e).scale(4294967296).floor(),g.Bc(e.x,e.y,d.wt,d.data);this.b=!0};n.Kb=function(a){Qs.l.Kb.call(this,a);this.Kc(this.a)};\nn.nf=function(a){for(var b=a.length,c=Qs.l.Kb;b--;)c.call(this,a[b]);this.Kc(this.a)};n.We=function(a){Qs.l.We.call(this,a);this.Kc(this.a)};n.Sa=function(a,b,c,d){return this.j.Sa(a/c/4294967296,b/c/4294967296,d)};n.yi=function(a){if(this.b){var b={clusters:[],noisePoints:[]};Rs(this,this.i.a,0,this.f+this.c,-1/0,b,null);this.b=!1;a(b)}};\nfunction Rs(a,b,c,d,e,f,g){var h=b.Nb,k;g&&(g.node.Nb!==h?(f.clusters.push(new Gs(a,g.node,g.depth,c-1)),g=null):e++);g||(h>=a.m?(g={node:b,depth:c},e=c):Ss(a,b,e+1,f));if(b.$d&&d--)for(c++,h=0;4>h;h++)if(k=b[h])Rs(a,k,c,d,e,f,g),g=null;g&&f.clusters.push(new Gs(a,g.node,g.depth,a.f+a.c))}function Ss(a,b,c,d){b=b.entries;var e;if(b){var f=b.length;d=d.noisePoints;for(e=0;e<f;e++)d.push(new Fs(a,b[e],c))}else for(e=0;4>e;e++)(f=a[e])&&Ss(a,f,c,d)}n.u=function(){Qs.l.u.call(this);this.i=null};function Ts(a,b,c,d){this.lat=a;this.lng=b;this.wt=c===+c?c:1;this.data=d}u(\"H.clustering.DataPoint\",Ts);Ts.prototype.a=NaN;Ts.prototype.b=NaN;function Us(a,b){b=b||{};var c={},d=b.min||0,e=Jc(d,b.max||22);d={min:d,max:e};Us.l.constructor.call(this,d);this.Jb=b.pixelRatio||1;Pa(c,ws,d,b.clusteringOptions||{});c.minWeight=Jc(ws.minWeight,c.minWeight);switch(c.strategy){case Vs.DYNAMICGRID:if(c.projection!==Hh)throw new D(Us,1,\"Unsupported projection\");this.a=new Bs(c);break;case Vs.GRID:this.a=new ys(c);break;default:this.a=new Qs(c)}this.a.Kc(a);this.v=b.theme||new zs(this.Jb);this.S=A(this.S,this);this.va=A(this.va,this);Ws(this)}\nw(Us,M);u(\"H.clustering.Provider\",Us);Us.prototype.u=function(){Us.l.u.call(this);this.b.ga();this.a.F();this.v=this.C=this.a=null;y.clearTimeout(this.Y)};var Vs={FASTGRID:0,GRID:1,DYNAMICGRID:2};Us.Strategy=Vs;Us.prototype.S=function(){this.dispatchEvent(\"start\");this.a.yi(this.va,vc)};function Ws(a,b,c){a.Y&&y.clearTimeout(a.Y);b&&a.a.Hk(b,c);a.Y=y.setTimeout(a.S,150)}Us.prototype.va=function(a){this.dispatchEvent(\"end\");this.C=a;Xs(this)};Us.prototype.Kc=function(a){this.a.Kc(a);Ws(this)};\nUs.prototype.setDataPoints=Us.prototype.Kc;Us.prototype.Kb=function(a){this.a.Kb(a);Ws(this)};Us.prototype.addDataPoint=Us.prototype.Kb;Us.prototype.nf=function(a){this.a.nf(a);Ws(this)};Us.prototype.addDataPoints=Us.prototype.nf;Us.prototype.We=function(a){this.a.We(a);Ws(this)};Us.prototype.removeDataPoint=Us.prototype.We;Us.prototype.Sm=function(){return this.v};Us.prototype.getTheme=Us.prototype.Sm;Us.prototype.Zn=function(a){this.v=a;this.C&&(this.b.ga(),Xs(this))};Us.prototype.setTheme=Us.prototype.Zn;\nfunction Xs(a){var b=a.C.clusters,c=a.C.noisePoints,d=b.length,e=c.length,f=0<d+e;for(a.b.ga();d--;){var g=b[d];a.b.U(a.v.getClusterPresentation(g))}for(;e--;)b=c[e],a.b.U(a.v.getNoisePresentation(b));f&&sj(a)}Us.prototype.Vb=function(){return!0};Us.prototype.providesDomMarkers=Us.prototype.Vb;Us.prototype.Wb=function(){return!0};Us.prototype.providesMarkers=Us.prototype.Wb;Us.prototype.Fc=function(){return!0};Us.prototype.providesSpatials=Us.prototype.Fc;Us.prototype.bi=function(a,b){Ws(this,a,b)};u(\"H.clustering.buildInfo\",function(){return pf(\"mapsjs-clustering\",\"1.6.0\",\"37552de\")});\n");